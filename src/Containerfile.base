FROM docker.io/archlinux:base

RUN set -exu \
  && pacman --noconfirm -Syyu \
  && pacman --noconfirm -Syy \
    gdm \
    gnome-shell \
    mesa \
    net-tools \
    pulseaudio \
    pulseaudio-alsa \
    socat \
    sudo \
    systemd \
    wayland \
    xorg-xwayland

COPY rootfs.base /

RUN set -exu \
  && dbus-uuidgen --ensure=/etc/machine-id \
  && dbus-uuidgen --ensure \
  && systemctl enable user-init.service \
  && systemctl --user --global enable gnome-shell.service \
  && systemctl --user --global enable setup-grd.service

VOLUME ["/sys/fs/cgroup"]
ENTRYPOINT ["/usr/local/sbin/init"]
